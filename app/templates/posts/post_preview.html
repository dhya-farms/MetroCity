{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}
{# Taken from : https://medium.com/@adandan01/django-inline-formsets-example-mybook-420cc4b6225d #}
  {% block customcss %}
    {{ form.media.css }}
   <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
   <style>
    .navbar {
      display: none;
    }
    #id_media_list li{
      float: left;
    }
    #main_form *{
      margin: 15px 0;
    }
    .spaced_out {
      margin-top:4px;
      margin-bottom:4px;
    }
    </style>
  {% endblock %}
{% block content %}
<div class="col-md-8 main_form" >
  <br/>
    <form class="post_preview_form" action="" method="post" enctype="multipart/form-data">{% csrf_token %}
        <button type="button" class="btn rounded p-1" id="close_button" style="float: right;"><span class="glyphicon glyphicon-remove"></span></button>
        <button type="button" class="btn rounded p-1" id="refresh_button" style="float: right;"><span class="glyphicon glyphicon-repeat"></span></button>
        <div class="fieldWrapper row" style="height:150px;overflow:auto;white-space:nowrap;border:1px;">
          {{ form.media_list.errors }}
          {{ form.media_list }}
       </div>
        <div class="row col-md-8" >
        <table class="table table-responsive-sm table-condensed" style="margin:0;font-size:80%;">
            {{ image_formset.management_form }}
            {% for form in image_formset.forms %}
                {% if forloop.first %}
                <thead>
                <tr>
                    {% for field in form.visible_fields %}
                        <th>{{ field.label|capfirst }}</th>
                    {% endfor %}
                </tr>
                </thead>
                {% endif %}
                <tr class="{% cycle 'row1' 'row2' %} image_formset_row">
                    {% for field in form.visible_fields %}
                        <td>
                            {{ field }}
                            {{ field.errors.as_ul }}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
        <table class="table table-responsive-sm table-condensed" style="margin:0;font-size:80%;" >
            {{ video_formset.management_form }}
            {% for form in video_formset.forms %}
                {% if forloop.first %}
                <thead>
                <tr>
                    {% for field in form.visible_fields %}
                        <th>{{ field.label|capfirst }}</th>
                    {% endfor %}
                </tr>
                </thead>
                {% endif %}
                <tr class="{% cycle 'row1' 'row2' %} video_formset_row">
                    {% for field in form.visible_fields %}
                        <td>
                            {# Include the hidden fields in the form #}
                            {% if forloop.first %}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            {% endif %}
                            {{ field }}
                            {{ field.errors.as_ul }}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
        </div>
      <div class="fieldWrapper spaced_out">
          {{ form.title.errors }}
          {{ form.title.label_tag }}<br>
          {{ form.title }}
       </div>
      <div class="fieldWrapper spaced_out">
          {{ form.english_title.errors }}
          {{ form.english_title.label_tag }}<button type="button" class="button_translate btn btn-primary btn-sm" id="_translate_english" style="margin:3px;"> Translate to English </button>
        <span id="translate_loader" style="display:none; padding:6px; margin-left:6px">
          <img src="'+static('images/loader-40x40.gif')+'" width="28px"/></span>
        <span id="translate_error" style="padding:6px; margin-left:6px"> </span><br>
          {{ form.english_title }}
       </div>
      <br>
      <div class="fieldWrapper">
          {{ form.content.errors }}
          {{ form.content }}
       </div>
      <div class="fieldWrapper ">
          {{ form.reporter.errors }}
          {{ form.reporter }}
       </div>
      <div class="row">
        <div class="col">
          <span style="font-weight:bold;">Reporter: </span>{{ reporter }}
        </div>
        <div class="fieldWrapper col">
          {{ form.suggest_for_notif.errors }}
          {{ form.suggest_for_notif.label_tag }}
          {{ form.suggest_for_notif }}
        </div>
      </div>
      <div class="fieldWrapper id_locations spaced_out">
          {{ form.locations.errors }}
          {{ form.locations.label_tag }}<br>
          {{ form.locations }}
       </div>
      <div class="fieldWrapper spaced_out">
          {{ form.categories.errors }}
          {{ form.categories.label_tag }}<br>
          {{ form.categories }}
       </div>
      <div class="fieldWrapper spaced_out">
          {{ form.ugc_categories.errors }}
          {{ form.ugc_categories.label_tag }}<br>
          {{ form.ugc_categories }}
       </div>
      <div class="fieldWrapper spaced_out">
          {{ form.tags.errors }}
          {{ form.tags.label_tag }}<br>
          {{ form.tags }}
       </div>
      <div class="fieldWrapper id_constituency spaced_out">
          {{ form.constituency.errors }}
          {{ form.constituency.label_tag }}<br>
          {{ form.constituency }}
       </div>
      <div class="fieldWrapper id_mandal spaced_out">
          {{ form.mandal.errors }}
          {{ form.mandal.label_tag }}<br>
          {{ form.mandal }}
       </div>
      <div class="fieldWrapper spaced_out">
          {{ form.updated_on.errors }}
          {{ form.updated_on.label_tag }}<br>
          {{ form.updated_on }}
       </div>
      <div class="fieldWrapper">
          {{ form.submission_id.errors }}
          {{ form.submission_id }}
       </div>
       <br>
        <input class="btn btn-primary" type="submit" value="Save"/>
        <button style="float:right;" class="btn btn-primary btn-sm" type="button" value="" id="back_button" onclick="backButton()">Back</button>
    </form>

  <br/>
</div>
{% endblock %}

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="{% static 'js/jquery.formset.js' %}"></script>
   {% block customjs %}
    {{ form.media.js }}

  <script type="text/javascript">
      $('.image_formset_row').formset({
          addText: 'add image',
          deleteText: 'remove',
          prefix: '{{ image_formset.prefix }}'
      });
      $('.video_formset_row').formset({
          addText: 'add video',
          deleteText: 'remove',
          prefix: '{{ video_formset.prefix }}'
      });
      function backButton() {
        var url = '/sub/edit/'+{{submission_id}}+'/';
        location.href =url;
      }

  </script>
  {% endblock %}

