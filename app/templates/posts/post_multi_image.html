{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}
{# Taken from : https://medium.com/@adandan01/django-inline-formsets-example-mybook-420cc4b6225d #}
  {% block customcss %}
    {{ form.media.css }}
  {% endblock %}
{% block content %}
<div class="col-md-8">
  <br/>
    <form action="" method="post" enctype="multipart/form-data">{% csrf_token %}
        {% comment %}
        {{ form.as_p }}
        {% endcomment %}

        {% block form %}
            {% crispy form %}
        {% endblock %}

        <table class="table">
            {{ image_formset.management_form }}

            {% for form in image_formset.forms %}
                {% if forloop.first %}
                    <thead>
                    <tr>
                        {% for field in form.visible_fields %}
                            <th>{{ field.label|capfirst }}</th>
                        {% endfor %}
                    </tr>
                    </thead>
                {% endif %}
                <tr class="{% cycle 'row1' 'row2' %} image_formset_row">
                    {% for field in form.visible_fields %}
                        <td>
                            {# Include the hidden fields in the form #}
                            {% if forloop.first %}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            {% endif %}
                            {{ field }}
                            {{ field.errors.as_ul }}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
        <table class="table">
            {{ video_formset.management_form }}

            {% for form in video_formset.forms %}
                {% if forloop.first %}
                    <thead>
                    <tr>
                        {% for field in form.visible_fields %}
                            <th>{{ field.label|capfirst }}</th>
                        {% endfor %}
                    </tr>
                    </thead>
                {% endif %}
                <tr class="{% cycle 'row1' 'row2' %} video_formset_row">
                    {% for field in form.visible_fields %}
                        <td>
                            {# Include the hidden fields in the form #}
                            {% if forloop.first %}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            {% endif %}
                            {{ field }}
                            {{ field.errors.as_ul }}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
        <span>Note: Videos will be uploaded on our YouTube channels also, it is in the best interest that you refer to <a href="https://www.youtube.com/t/terms" target="_blank">YouTube Terms of Services</a></span><br/><br/>
        <input class="btn btn-primary" type="submit" value="Save"/> <a href="{% url 'post-list' %}">back to the list</a>
    </form>
  <br/>
</div>
{% endblock %}

  {# comment #}
  {% block customjs %}
    {{ form.media.js }}

  <script type="text/javascript">
      $('.image_formset_row').formset({
          addText: 'add image',
          deleteText: 'remove',
          prefix: '{{ image_formset.prefix }}'
      });
      $('.video_formset_row').formset({
          addText: 'add video',
          deleteText: 'remove',
          prefix: '{{ video_formset.prefix }}'
      });

      $(document).ready(function(){
          var button_html = '<button type="button" class="button button_translate" id="_translate_english" > Translate to English </button> \
            <span id="translate_loader" style="display:none; padding:6px; margin-left:6px"> \
            <img src="{% static 'images/loader-40x40.gif' %}" width="28px"/></span> \
            <span id="translate_error" style="padding:6px; margin-left:6px"> </span>';
          $("#div_id_english_title").before(button_html);
      });

      $(document).on("click", "#_translate_english", function(){
          var title = $("input#id_title").val();
          $("#translate_loader").show();
          $("#translate_error").text("");
          $.ajax({
              method: "GET",
              url: "/posts/translate/",
              data: {text: title},
              timeout: 4000,
          }).done(function(data, status){
              $("#translate_loader").hide();
              $("#translate_error").text("Success!").css('background-color', 'lightgreen');
              $("input#id_english_title").val(data);
          }).fail(function(xhr, status, error){
              console.log(error);
              $("#translate_error").text(error).css('background-color', 'lightred');
          }).always(function(){
              $("#translate_loader").hide();
          });
      });
  </script>
  {% endblock %}
  {# endcomment #}

